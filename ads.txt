CREATE DATABASE OLTP_Aryan;
CREATE DATABASE OLAP_Aryan;



-- Create Tables
CREATE TABLE CATEGORY (
    ID SERIAL PRIMARY KEY,
    CATEGORY_DESC VARCHAR(1024)
);


CREATE TABLE COUNTRY (
    ID SERIAL PRIMARY KEY,
    COUNTRY_DESC VARCHAR(256)
);

CREATE TABLE CUSTOMER (
    ID SERIAL PRIMARY KEY,
    CUSTOMER_FIRST_NAME VARCHAR(256),
    CUSTOMER_MIDDLE_NAME VARCHAR(256),
    CUSTOMER_LAST_NAME VARCHAR(256),
    CUSTOMER_ADDRESS VARCHAR(256)
);

CREATE TABLE SUBCATEGORY (
    ID SERIAL PRIMARY KEY,
    CATEGORY_ID INT REFERENCES CATEGORY(ID),
    SUBCATEGORY_DESC VARCHAR(256)
);

CREATE TABLE PRODUCT (
    ID SERIAL PRIMARY KEY,
    SUBCATEGORY_ID INT REFERENCES SUBCATEGORY(ID),
    PRODUCT_DESC VARCHAR(256)
);

CREATE TABLE REGION (
    ID SERIAL PRIMARY KEY,
    COUNTRY_ID INT REFERENCES COUNTRY(ID),
    REGION_DESC VARCHAR(256)
);

CREATE TABLE STORE (
    ID SERIAL PRIMARY KEY,
    REGION_ID INT REFERENCES REGION(ID),
    STORE_DESC VARCHAR(256)
);

CREATE TABLE SALES (
    ID SERIAL PRIMARY KEY,
    STORE_ID INT NOT NULL REFERENCES STORE(ID),
    PRODUCT_ID INT NOT NULL REFERENCES PRODUCT(ID),
    CUSTOMER_ID INT REFERENCES CUSTOMER(ID),
    TRANSACTION_TIME TIMESTAMP,
    QUANTITY INT,
    AMOUNT NUMERIC(20,2),
    DISCOUNT NUMERIC(20,2)
);

-- Seed Data for OLTP_Aryan
INSERT INTO COUNTRY (COUNTRY_DESC) VALUES
('Nepal'),
('India');

INSERT INTO REGION (COUNTRY_ID, REGION_DESC) VALUES
(1, 'Kathmandu'),
(1, 'Lalitpur'),
(2, 'Punjab'),
(2, 'Bangalore');

INSERT INTO STORE (REGION_ID, STORE_DESC) VALUES
(1, 'RETAIL Chakrapath'),
(2, 'RETAIL Pulchowk'),
(3, 'RETAIL Chandigarh'),
(4, 'RETAIL Jayanagar');

INSERT INTO CATEGORY (CATEGORY_DESC) VALUES
('Garment'),
('GROCERY'),
('KitchenWares');

INSERT INTO SUBCATEGORY (CATEGORY_ID, SUBCATEGORY_DESC) VALUES
(1, 'MENS WEAR'),
(1, 'WOMENS WEAR'),
(1, 'KIDS WEAR'),
(2, 'Dairy'),
(2, 'Fruits'),
(2, 'Packed Items'),
(3, 'Utensils'),
(3, 'Glassware'),
(3, 'Electric Appliances');

INSERT INTO PRODUCT (SUBCATEGORY_ID, PRODUCT_DESC) VALUES
(1, 'Jeans'),
(2, 'Shirt'),
(1, 'Shoes'),
(5, 'Apple'),
(5, 'Oranges'),
(4, 'Milk'),
(4, 'Butter'),
(9, 'Microwave'),
(9, 'Coffee Maker'),
(7, 'Plate'),
(6, 'Wai Wai'),
(6, 'Oats'),
(3, 'Diaper'),
(8, 'Glass'),
(8, 'Jug'),
(2, 'Skirt'),
(7, 'Spoon'),
(3, 'Kids Jacket');

INSERT INTO CUSTOMER (CUSTOMER_FIRST_NAME, CUSTOMER_MIDDLE_NAME, CUSTOMER_LAST_NAME, CUSTOMER_ADDRESS) VALUES
('Ram', NULL, 'Adhikari', 'Kathmandu'),
('Shyam', 'Prasad', 'Sharma', 'Lalitpur'),
('Hari', NULL, 'Poudel', 'Bhaktapur'),
('Saurav', 'Muhammed', 'Ali', 'Bangalore'),
('Kannur', 'Lokesh', 'Rahul', 'Punjab'),
('James', NULL, 'Singh', 'Chennai');






-- Create Tables in OLAP_Aryan.TARGET Schema
CREATE TABLE D_RETAIL_CNTRY_T (
    CNTRY_ID INT,
    CNTRY_KY SERIAL PRIMARY KEY,
    CNTRY_DESC VARCHAR(50),              
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE D_RETAIL_CTGRY_T (
    CTGRY_ID INT,
    CTGRY_KY SERIAL PRIMARY KEY,
    CTGRY_DESC VARCHAR(50),
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE D_RETAIL_CUSTOMER_T (
    CUSTOMER_ID INT,
    CUSTOMER_KY SERIAL PRIMARY KEY,
    CUSTOMER_FST_NM VARCHAR(20),
    CUSTOMER_MID_NM VARCHAR(20),
    CUSTOMER_LST_NM VARCHAR(20),
    CUSTOMER_ADDR VARCHAR(20),
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE D_RETAIL_LOCN_T (
    LOCN_ID INT,
    LOCN_KY SERIAL PRIMARY KEY,
    RGN_KY INT,
    CNTRY_KY INT,
    LOCN_DESC VARCHAR(50),
    LAST_OPEN_TMS TIMESTAMP,
    LAST_CLOSED_TMS TIMESTAMP,
    ACTV_FLG VARCHAR(1),
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE D_RETAIL_PDT_T (
    PDT_ID INT,
    PDT_KY SERIAL PRIMARY KEY,
    SUB_CTGRY_KY INT,
    CTGRY_KY INT,
    PDT_DESC VARCHAR(50),
    PRICE NUMERIC(10,2),
    ACTV_FLG VARCHAR(1),
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE D_RETAIL_RGN_T (
    RGN_ID INT,
    RGN_KY SERIAL PRIMARY KEY,
    CNTRY_KY INT,
    RGN_DESC VARCHAR(50),
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE D_RETAIL_SUB_CTGRY_T (
    SUB_CTGRY_ID INT,
    SUB_CTGRY_KY SERIAL PRIMARY KEY,
    CTGRY_KY INT,
    SUB_CTGRY_DESC VARCHAR(50),
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE D_RETAIL_TIME_DAY_T (
    ID DATE NOT NULL,
    DT_KY DATE NOT NULL PRIMARY KEY,
    MONTH_KY INT,
    QUARTER_KY INT NOT NULL,
    YEAR_KY INT NOT NULL,
    HALF_YEAR_KY INT NOT NULL,
    DAY_START_TIME TIMESTAMP NOT NULL,
    DAY_END_TIME TIMESTAMP NOT NULL,
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE D_RETAIL_TIME_HALF_YEAR_T (
    ID TEXT NOT NULL,
    HALF_YEAR_KY INT NOT NULL PRIMARY KEY,
    YEAR_KY INT NOT NULL,
    HALF_YEAR_START_DATE DATE NOT NULL,
    HALF_YEAR_END_DATE DATE NOT NULL,
    OPEN_CLOSE_CD VARCHAR(1),
    ROW_INSRT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ROW_UPDT_TMS TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);



CREATE TABLE D_RETAIL_TIME_HOUR_T (
    ID INT,
    HOUR_KY INT NOT NULL PRIMARY KEY
);

CREATE TABLE D_RETAIL_TIME_MIN_T (
    ID INT,
    MIN_KY INT NOT NULL PRIMARY KEY,
    HOUR_KY INT
);